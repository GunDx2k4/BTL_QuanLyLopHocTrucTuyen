@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
@model BTL_QuanLyLopHocTrucTuyen.Models.Submission

@{
    ViewData["Title"] = "Chi tiết bài nộp";
    var submission = Model;
    var assignment = submission?.Assignment;
    var course = assignment?.Lesson?.Course;
    var instructor = course?.Instructor;
}

<div class="container mt-4">
    <!-- Breadcrumb - Đường dẫn điều hướng -->
    <nav aria-label="breadcrumb" class="mb-3">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Index", "Student")">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="@Url.Action("MySubmissions", "Student")">Bài đã nộp</a></li>
            <li class="breadcrumb-item active">Chi tiết bài nộp</li>
        </ol>
    </nav>

    <!-- Tiêu đề và trạng thái -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="mb-2">📝 Chi tiết bài nộp</h2>
            <h4 class="text-primary">Bài tập 1: Tạo ứng dụng Hello World</h4>
            <p class="text-muted mb-0">
                <span class="badge bg-success me-2">Đã chấm điểm</span>
                <span class="badge bg-info">Nộp sớm 3 ngày</span>
            </p>
        </div>
        <div class="col-md-4 text-end">
            <div class="mb-2">
                <h3 class="text-success mb-0">🎯 Điểm: 9.0/10</h3>
            </div>
            <button class="btn btn-primary" onclick="window.print()">
                🖨️ In bài nộp
            </button>
        </div>
    </div>

    <!-- Thông tin bài tập -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">📋 Thông tin bài tập</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-2"><strong>📚 Khóa học:</strong> Lập trình Web với ASP.NET Core</p>
                            <p class="mb-2"><strong>👨‍🏫 Giảng viên:</strong> Nguyễn Văn A</p>
                            <p class="mb-2"><strong>📅 Ngày giao:</strong> 01/09/2025</p>
                            <p class="mb-0"><strong>⏰ Hạn nộp:</strong> 08/09/2025 - 23:59</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>📊 Trạng thái:</strong> <span class="badge bg-success">Đã chấm điểm</span></p>
                            <p class="mb-2"><strong>🎯 Điểm số:</strong> <span class="text-success fs-5">9.0/10</span></p>
                            <p class="mb-2"><strong>🏆 Xếp loại:</strong> <span class="badge bg-success">Xuất sắc</span></p>
                            <p class="mb-0"><strong>📈 Xếp hạng lớp:</strong> Top 5/45 sinh viên</p>
                        </div>
                    </div>

                    <hr>

                    <h6>📋 Yêu cầu bài tập:</h6>
                    <div class="bg-light p-3 rounded">
                        <ol class="mb-0">
                            <li>Tạo project ASP.NET Core MVC mới</li>
                            <li>Tạo Controller "HelloController" với action "Index"</li>
                            <li>Tạo View hiển thị "Hello World"</li>
                            <li>Chạy được ứng dụng và chụp màn hình kết quả</li>
                            <li>Nén toàn bộ project thành file ZIP</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Thông tin bài nộp -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">📤 Thông tin bài nộp</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-2"><strong>📅 Ngày nộp:</strong> 05/09/2025 - 14:30</p>
                            <p class="mb-2"><strong>⏰ Thời gian còn lại khi nộp:</strong> <span class="text-success">3 ngày 9 giờ 29 phút</span></p>
                            <p class="mb-2"><strong>📎 File nộp:</strong> <a href="#" onclick="downloadFile(1)">HelloWorld_StudentName.zip</a></p>
                            <p class="mb-0"><strong>📦 Kích thước:</strong> 2.5 MB</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>🔄 Số lần nộp:</strong> 1 lần (Lần đầu)</p>
                            <p class="mb-2"><strong>💾 Lần nộp cuối:</strong> 05/09/2025 - 14:30</p>
                            <p class="mb-2"><strong>🎯 Trạng thái:</strong> <span class="badge bg-success">Đã chấm điểm</span></p>
                            <p class="mb-0"><strong>📝 Ngày chấm:</strong> 10/09/2025 - 16:45</p>
                        </div>
                    </div>

                    <hr>

                    <h6>📝 Ghi chú của bạn khi nộp:</h6>
                    <div class="bg-light p-3 rounded">
                        <p class="mb-0 fst-italic">
                            "Em đã hoàn thành đầy đủ các yêu cầu của bài tập. Em tạo project, tạo controller, view và chạy thành công.
                            Em có chụp màn hình kết quả và đính kèm trong file ZIP. Em cảm ơn thầy!"
                        </p>
                    </div>

                    <div class="mt-3 text-center">
                        <button class="btn btn-primary btn-lg" onclick="downloadFile(1)">
                            📥 Tải file đã nộp
                        </button>
                        <button class="btn btn-info btn-lg" data-bs-toggle="modal" data-bs-target="#previewModal">
                            👁️ Xem trước
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kết quả chấm điểm -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">📊 Kết quả chấm điểm</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="text-center p-3 bg-success text-white rounded">
                                <h1 class="mb-0">9.0/10</h1>
                                <p class="mb-0">Điểm tổng</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-2"><strong>👨‍🏫 Người chấm:</strong> Nguyễn Văn A (Giảng viên)</p>
                            <p class="mb-2"><strong>📅 Ngày chấm:</strong> 10/09/2025 - 16:45</p>
                            <p class="mb-2"><strong>⏱️ Thời gian chấm:</strong> 5 ngày sau khi nộp</p>
                            <p class="mb-0"><strong>🏆 Xếp loại:</strong> <span class="badge bg-success fs-6">Xuất sắc</span></p>
                        </div>
                    </div>

                    <hr>

                    <h6>📋 Chi tiết điểm theo tiêu chí:</h6>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 5%">#</th>
                                    <th style="width: 45%">Tiêu chí</th>
                                    <th style="width: 15%">Điểm tối đa</th>
                                    <th style="width: 15%">Điểm đạt được</th>
                                    <th style="width: 20%">Đánh giá</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Ứng dụng chạy được không lỗi</td>
                                    <td class="text-center">3.0</td>
                                    <td class="text-center"><strong class="text-success">3.0</strong></td>
                                    <td><span class="badge bg-success">Đạt yêu cầu</span></td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Đầy đủ chức năng theo yêu cầu</td>
                                    <td class="text-center">4.0</td>
                                    <td class="text-center"><strong class="text-success">4.0</strong></td>
                                    <td><span class="badge bg-success">Hoàn hảo</span></td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>Giao diện đẹp, responsive</td>
                                    <td class="text-center">2.0</td>
                                    <td class="text-center"><strong class="text-success">2.0</strong></td>
                                    <td><span class="badge bg-success">Tốt</span></td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td>Code sạch, có comment, dễ đọc</td>
                                    <td class="text-center">1.0</td>
                                    <td class="text-center"><strong class="text-warning">0.0</strong></td>
                                    <td><span class="badge bg-warning">Cần cải thiện</span></td>
                                </tr>
                            </tbody>
                            <tfoot class="table-success">
                                <tr>
                                    <th colspan="2" class="text-end">Tổng điểm:</th>
                                    <th class="text-center">10.0</th>
                                    <th class="text-center"><strong>9.0</strong></th>
                                    <th><span class="badge bg-success">Xuất sắc</span></th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Nhận xét của giảng viên -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-header bg-warning">
                    <h5 class="mb-0">💬 Nhận xét của giảng viên</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                    <strong>NA</strong>
                                </div>
                            </div>
                            <div class="flex-grow-1">
                                <div class="bg-light p-3 rounded">
                                    <div class="d-flex justify-content-between mb-2">
                                        <strong>Nguyễn Văn A (Giảng viên)</strong>
                                        <small class="text-muted">10/09/2025 - 16:45</small>
                                    </div>
                                    <p class="mb-0">
                                        Bài làm rất tốt! Code chạy đúng yêu cầu, giao diện đẹp, dễ nhìn.
                                        Em đã nắm vững kiến thức cơ bản về ASP.NET Core MVC.
                                        Tuy nhiên, em cần chú ý thêm về việc viết comment cho code để code dễ đọc và dễ bảo trì hơn.
                                        Tiếp tục cố gắng nhé!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <h6>📝 Những điểm làm tốt:</h6>
                    <ul class="text-success">
                        <li>Code chạy mượt mà, không có lỗi</li>
                        <li>Đầy đủ chức năng theo yêu cầu</li>
                        <li>Giao diện Bootstrap đẹp và responsive</li>
                        <li>Nộp bài đúng hạn, thậm chí sớm 3 ngày</li>
                    </ul>

                    <h6>⚠️ Những điểm cần cải thiện:</h6>
                    <ul class="text-warning">
                        <li>Thiếu comment trong code, khó hiểu ý đồ của từng đoạn code</li>
                        <li>Có thể thêm error handling để ứng dụng robust hơn</li>
                    </ul>

                    <h6>💡 Gợi ý cho bài tập tiếp theo:</h6>
                    <ul class="text-info">
                        <li>Học thêm về coding conventions và best practices</li>
                        <li>Thêm exception handling và validation</li>
                        <li>Tìm hiểu về SOLID principles</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Lịch sử nộp lại (nếu có) -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-secondary">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">📜 Lịch sử nộp bài</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 10%">Lần nộp</th>
                                    <th style="width: 20%">Ngày nộp</th>
                                    <th style="width: 25%">File</th>
                                    <th style="width: 15%">Trạng thái</th>
                                    <th style="width: 15%">Điểm</th>
                                    <th style="width: 15%">Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-success">
                                    <td class="text-center"><strong>Lần 1</strong></td>
                                    <td>05/09/2025 - 14:30</td>
                                    <td>HelloWorld_StudentName.zip</td>
                                    <td><span class="badge bg-success">Đã chấm</span></td>
                                    <td><strong class="text-success">9.0/10</strong></td>
                                    <td>
                                        <button class="btn btn-sm btn-primary" onclick="downloadFile(1)">
                                            📥 Tải
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="alert alert-info mt-3 mb-0" role="alert">
                        <strong>ℹ️ Lưu ý:</strong> Đây là lần nộp đầu tiên và duy nhất. Bạn đã đạt điểm cao nên không cần nộp lại.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Thông tin thêm -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">📊 Thống kê</h5>
                </div>
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Số lần xem bài tập:</span>
                            <strong>8 lần</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Số lần tải tài liệu:</span>
                            <strong>3 lần</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Thời gian làm bài ước tính:</span>
                            <strong>~5 giờ</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Lần truy cập cuối:</span>
                            <strong>05/09/2025</strong>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">🎯 So sánh lớp học</h5>
                </div>
                <div class="card-body">
                    <p class="mb-2"><strong>Điểm trung bình lớp:</strong> 7.2/10</p>
                    <p class="mb-3"><strong>Điểm của bạn:</strong> <span class="text-success">9.0/10</span> (Cao hơn TB)</p>

                    <div class="mb-3">
                        <small class="text-muted">Phân bố điểm lớp:</small>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-danger" style="width: 10%" title="0-5: 5 SV">5 SV</div>
                            <div class="progress-bar bg-warning" style="width: 20%" title="5-7: 10 SV">10 SV</div>
                            <div class="progress-bar bg-info" style="width: 35%" title="7-8: 15 SV">15 SV</div>
                            <div class="progress-bar bg-success" style="width: 35%" title="8-10: 15 SV">15 SV</div>
                        </div>
                        <div class="d-flex justify-content-between mt-1">
                            <small>0</small>
                            <small>5</small>
                            <small>7</small>
                            <small>8</small>
                            <small>10</small>
                        </div>
                    </div>

                    <p class="mb-0">
                        <strong>🏆 Xếp hạng:</strong>
                        <span class="badge bg-success">Top 5/45 sinh viên</span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Thông báo -->
    <div class="alert alert-success" role="alert">
        <h5 class="alert-heading">🎉 Chúc mừng!</h5>
        <p class="mb-0">
            Bạn đã hoàn thành xuất sắc bài tập này với điểm 9.0/10.
            Tiếp tục phát huy và cải thiện những điểm còn thiếu sót nhé!
        </p>
    </div>

    <!-- Nút hành động -->
    <div class="row mt-4 mb-4">
        <div class="col-12 d-flex gap-2">
            <button class="btn btn-primary" onclick="downloadFile(1)">
                📥 Tải file đã nộp
            </button>
            <button class="btn btn-info" onclick="window.print()">
                🖨️ In trang này
            </button>
            <a href="@Url.Action("Assignments", "Student")" class="btn btn-success">
                📝 Xem bài tập khác
            </a>
        </div>
    </div>
</div>

<!-- Modal xem trước file -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="previewModalLabel">👁️ Xem trước file</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info" role="alert">
                    <strong>💡 Lưu ý:</strong> Chức năng xem trước file sẽ hoạt động khi có Backend hỗ trợ.
                </div>
                <div class="text-center p-5 bg-light">
                    <p class="text-muted">Preview file sẽ hiển thị tại đây</p>
                    <p class="text-muted">(PDF Viewer, Image Viewer, hoặc Code Viewer)</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" onclick="downloadFile(1)">
                    📥 Tải file
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Hàm tải file đã nộp
        function downloadFile(submissionId) {
            // TODO: Gọi API để download file khi có Backend
            // GET /api/submissions/{submissionId}/download
            alert('📥 Chức năng tải file sẽ hoạt động khi kết nối Backend!\n\nBackend cần:\n- API: GET /api/submissions/' + submissionId + '/download\n- Trả về file để browser download');
        }
    </script>
}