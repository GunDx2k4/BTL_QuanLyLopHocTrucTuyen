@model IEnumerable<BTL_QuanLyLopHocTrucTuyen.Models.Course>

@{
    ViewData["Title"] = "Kh√≥a h·ªçc ƒë∆∞·ª£c giao";
    Layout = "~/Views/Instructor/Shared/_InstructorLayout.cshtml";
}

<link rel="stylesheet" href="~/css/Instructor/Course/Course.css" asp-append-version="true" />

<div class="content-main course-page">
    <!-- Header -->
    <div class="header-course d-flex justify-content-between align-items-center mb-3">
        <h4 class="fw-bold text-primary mb-0">
            <i class="bi bi-mortarboard-fill me-2"></i>Kh√≥a h·ªçc gi·∫£ng d·∫°y
        </h4>

        <!-- üîç Thanh t√¨m ki·∫øm & s·∫Øp x·∫øp -->
        <div class="d-flex align-items-center gap-2">
            <input type="text" id="searchCourse" class="form-control form-control-sm" placeholder="üîç T√¨m ki·∫øm kh√≥a h·ªçc..." style="width: 220px;">
            <select id="sortCourse" class="form-select form-select-sm" style="width: 180px;">
                <option value="recent">M·ªõi nh·∫•t</option>
                <option value="begin">Theo ng√†y b·∫Øt ƒë·∫ßu</option>
                <option value="end">Theo ng√†y k·∫øt th√∫c</option>
                <option value="status">Theo tr·∫°ng th√°i</option>
            </select>
        </div>
    </div>

    <!-- L∆∞·ªõi kh√≥a h·ªçc -->
    <div class="course-grid" id="courseGrid">
        @if (Model != null && Model.Any())
        {
            foreach (var course in Model)
            {
                var now = DateTime.Now;
                string statusText;
                string statusColor;

                if (now < course.BeginTime)
                {
                    statusText = "Ch∆∞a b·∫Øt ƒë·∫ßu";
                    statusColor = "text-secondary";
                }
                else if (now >= course.BeginTime && now <= course.EndTime)
                {
                    statusText = "ƒêang di·ªÖn ra";
                    statusColor = "text-success";
                }
                else
                {
                    statusText = "ƒê√£ k·∫øt th√∫c";
                    statusColor = "text-danger";
                }

                string headerColor = course.Status switch
                {
                    BTL_QuanLyLopHocTrucTuyen.Models.Enums.ScheduleStatus.Active => "bg-blue",
                    BTL_QuanLyLopHocTrucTuyen.Models.Enums.ScheduleStatus.Completed => "bg-green",
                    BTL_QuanLyLopHocTrucTuyen.Models.Enums.ScheduleStatus.Planned => "bg-orange",
                    _ => "bg-blue"
                };

                <div class="course-card shadow-sm"
                     data-id="@course.Id"
                     data-name="@course.Name.ToLower()"
                     data-desc="@course.Description?.ToLower()"
                     data-begin="@course.BeginTime.ToString("yyyyMMdd")"
                     data-end="@course.EndTime.ToString("yyyyMMdd")"
                     data-created="@course.CreatedAt.ToString("yyyy-MM-ddTHH:mm:ss")"
                     data-status="@statusText">
                    <div class="course-header @headerColor" style="cursor: pointer;" title="Nh·∫•n ƒë·ªÉ ch·ªçn kh√≥a h·ªçc n√†y üéì">
                        <i class="bi bi-journal-bookmark-fill"></i>
                        <h5 class="title">@course.Name</h5>
                    </div>

                    <div class="course-body">
                        <p><i class="bi bi-person-workspace me-2"></i>Gi·∫£ng vi√™n: <strong>@course.Instructor?.FullName</strong></p>
                        <p><i class="bi bi-calendar-week me-2"></i>
                            <strong>@course.BeginTime.ToString("dd/MM/yyyy")</strong> ‚Üí <strong>@course.EndTime.ToString("dd/MM/yyyy")</strong>
                        </p>
                        <p><i class="bi bi-circle-fill @statusColor me-2"></i><span class="fw-semibold">@statusText</span></p>
                        @if (!string.IsNullOrEmpty(course.Description))
                        {
                            <p class="desc mt-2 text-muted">@course.Description</p>
                        }
                    </div>
                    <div class="course-footer">
                        <a asp-controller="LessonInstructor" asp-action="Lesson" asp-route-courseId="@course.Id" class="btn btn-primary btn-sm">
                            <i class="bi bi-journal-bookmark me-1"></i>B√†i h·ªçc
                        </a>
                        <a asp-controller="MaterialInstructor" asp-action="Material" asp-route-courseId="@course.Id" class="btn btn-success btn-sm">
                            <i class="bi bi-file-earmark-text me-1"></i>T√†i li·ªáu
                        </a>
                        <a asp-controller="AssignmentInstructor" asp-action="Assignment" asp-route-courseId="@course.Id" class="btn btn-warning btn-sm text-dark">
                            <i class="bi bi-pass me-1"></i>B√†i t·∫≠p
                        </a>
                        <a asp-controller="StudentInstructor" asp-action="Index" asp-route-courseId="@course.Id" class="btn btn-secondary btn-sm">
                            <i class="bi bi-people me-1"></i>H·ªçc vi√™n
                        </a>
                    </div>
                </div>
            }
        }
        else
        {
            <p class="text-muted">Hi·ªán t·∫°i b·∫°n ch∆∞a ƒë∆∞·ª£c giao kh√≥a h·ªçc n√†o üéì</p>
        }
    </div>
</div>

@section Scripts {
    <script src="~/js/Instructor/Course/Course.js" asp-append-version="true"></script>
}
