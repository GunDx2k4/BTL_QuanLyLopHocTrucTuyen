@using System.Security.Claims
@{
    Layout = null;
     var courseName = User.FindFirst("CurrentCourseName")?.Value ?? "Kh√≥a h·ªçc";
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Instructor Panel</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/Instructor/_InstructorLayout.css" asp-append-version="true" />
</head>
<body>
    <div class="instructor-container">
        <!-- ‚úÖ Sidebar -->
        <nav id="sidebar" class="sidebar">
            <div class="sidebar-header text-center mb-3">
                <h4 class="fw-bold">Gi·∫£ng vi√™n</h4>
            </div>

            <ul class="nav flex-column">
                <li class="nav-item">
                    <a asp-controller="HomeInstructor" asp-action="Index" class="nav-link">
                        <i class="bi bi-house-door me-2"></i>Trang ch·ªß
                    </a>
                </li>

                <li class="nav-item">
                    <a asp-controller="CourseInstructor" asp-action="Course" class="nav-link">
                        <i class="bi bi-journal-bookmark me-2"></i>Kh√≥a h·ªçc
                    </a>
                </li>
                <hr />

                <li class="nav-item">
                    <a asp-controller="LessonInstructor" asp-action="Lesson" class="nav-link">
                        <i class="bi bi-book me-2"></i>B√†i h·ªçc
                    </a>
                </li>

                <li class="nav-item">
                    <a asp-controller="AssignmentInstructor" asp-action="Assignment" class="nav-link">
                        <i class="bi bi-clipboard-check me-2"></i>B√†i t·∫≠p
                    </a>
                </li>

                <li class="nav-item">
                    <a asp-controller="MaterialInstructor" asp-action="Material" class="nav-link">
                        <i class="bi bi-file-earmark-text me-2"></i>T√†i li·ªáu
                    </a>
                </li>

                <li class="nav-item">
                    <a asp-controller="StudentInstructor" asp-action="Student" class="nav-link">
                        <i class="bi bi-people me-2"></i>H·ªçc vi√™n
                    </a>
                </li>
                <li class="nav-item">
                    <a asp-controller="GradeInstructor" asp-action="Grade" class="nav-link">
                        <i class="bi bi-award me-2"></i>ƒêi·ªÉm
                    </a>
                </li>

                <li class="nav-item">
                    <a asp-controller="CalendarInstructor" asp-action="Calendar" class="nav-link">
                        <i class="bi bi-calendar-week me-2"></i>L·ªãch
                    </a>
                </li>

                <li class="nav-item">
                    <a asp-controller="StatisticInstructor" asp-action="Statistic" class="nav-link">
                        <i class="bi bi-bar-chart-line me-2"></i>Th·ªëng k√™
                    </a>
                </li>

                <hr class="text-white-50" />

                <li class="nav-item">
                    <a asp-controller="SettingInstructor" asp-action="Index" class="nav-link">
                        <i class="bi bi-gear me-2"></i>C√†i ƒë·∫∑t
                    </a>
                </li>
            </ul>
        </nav>

        <!-- ‚úÖ Overlay (mobile sidebar background) -->
        <div class="sidebar-overlay"></div>

        <!-- ‚úÖ Main content -->
        <main class="main-content">
            <!-- ===== Header c·ªßa gi·∫£ng vi√™n ===== -->
            <div class="header-instructor">
                <!-- Nh√≥m tr√°i: toggle + breadcrumb -->
                <div class="header-left d-flex align-items-center">
                    <button id="toggleSidebar" class="btn btn-primary me-2">
                        <i class="bi bi-layout-sidebar-inset"></i>
                    </button>
                    <div class="instructor-breadcrumb d-flex align-items-center gap-2">
                        <span class="text-primary fw-semibold">@courseName</span>
                        <i class="bi bi-chevron-right small text-muted"></i>
                        <span class="text-muted">@ViewData["Title"]</span>
                    </div>
                </div>

                <!-- Nh√≥m ph·∫£i: account -->
                <div class="dropdown">
                    <button id="Account-Instructor" class="btn btn-light d-flex align-items-center" data-bs-toggle="dropdown">
                        <span class="material-icons me-1">account_circle</span>
                        <i class="bi bi-caret-down-fill small"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end shadow">
                        <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Trang c√° nh√¢n</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>C√†i ƒë·∫∑t</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" onclick="logout(event)" href="#"><i class="bi bi-box-arrow-right me-2"></i>ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                </div>
            </div>


            <!-- ===== Render n·ªôi dung t·ª´ng trang con ===== -->
            <div class="main-body">
                @RenderBody()
            </div>
        </main>
    </div>

    <script>
        const logout = (event) => {
            event.preventDefault();

            // üü° Ki·ªÉm tra n·∫øu trang hi·ªán t·∫°i l√† Add ho·∫∑c Edit
            const currentUrl = window.location.pathname.toLowerCase();
            const isEditingPage = currentUrl.includes("/add") || currentUrl.includes("/edit");

            if (isEditingPage) {
                const confirmLogout = confirm("‚ö†Ô∏è B·∫°n ƒëang ·ªü trang nh·∫≠p li·ªáu. N·∫øu tho√°t, d·ªØ li·ªáu ch∆∞a l∆∞u s·∫Ω b·ªã m·∫•t.\nB·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t?");
                if (!confirmLogout) {
                    return; // ‚ùå Hu·ª∑ logout
                }
            }

            // ‚úÖ G·ªçi API logout
            fetch('/api/authen/logout', { method: 'POST' })
                .then(response => {
                    if (response.ok) {
                        // X√≥a to√†n b·ªô cookie ho·∫∑c session l∆∞u course n·∫øu c·∫ßn
                        window.location.href = '/Home/Index';
                    } else {
                        alert('‚ùå ƒêƒÉng xu·∫•t th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i!');
                    }
                })
                .catch(error => {
                    console.error('Error during logout:', error);
                    alert('‚ö†Ô∏è ƒê√£ x·∫£y ra l·ªói. Vui l√≤ng th·ª≠ l·∫°i.');
                });
        };
    </script>


    <!-- Bootstrap JS + Custom Script -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/dist/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/Instructor/_Layout.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)

</body>
</html>
