@{
    ViewData["Title"] = "Th·ªëng k√™ h·ªçc vi√™n";
    Layout = "~/Views/Instructor/Shared/_InstructorLayout.cshtml";
}

<link rel="stylesheet" href="~/css/Instructor/Statistic/Statistic.css" asp-append-version="true" />

<div class="content-main statistic-page">

    <!-- üîπ HEADER -->
    <div class="header-statistic d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
        <h4 class="fw-bold text-primary mb-0">
            <i class="bi bi-bar-chart-line-fill me-2"></i>Th·ªëng k√™ h·ªçc vi√™n & b√†i t·∫≠p
            <small class="text-muted">(@ViewBag.CurrentCourseName)</small>
        </h4>

        <!-- B·ªô l·ªçc kh√≥a h·ªçc -->
        <div class="filter-course position-relative" style="min-width:260px;">
            <div class="input-wrapper position-relative">
                <input type="text" id="courseSearch" class="form-control pe-5"
                       placeholder="T√¨m ho·∫∑c ch·ªçn kh√≥a h·ªçc..."
                       value="@ViewBag.CurrentCourseName" autocomplete="off">
                <button type="button" id="clearCourse" class="btn-clear" title="X√≥a l·ª±a ch·ªçn">&times;</button>
            </div>

            <ul id="courseDropdown"
                class="list-group position-absolute w-100 shadow-sm bg-white border"
                style="display:none; z-index:1050; max-height:240px; overflow-y:auto;">
                @foreach (var course in ViewBag.Courses)
                {
                    <li class="list-group-item list-group-item-action @(course.Id == ViewBag.CurrentCourseId ? "active" : "")"
                        data-id="@course.Id">@course.Name</li>
                }
            </ul>
        </div>
    </div>

    <!-- üîπ TH·ªêNG K√ä T·ªîNG QUAN -->
    <div class="overview-grid mb-4">
        <div class="stat-card bg-gradient-primary">
            <i class="bi bi-journal-code"></i>
            <div>
                <p class="label">Kh√≥a h·ªçc ƒëang d·∫°y</p>
                <h5 class="value">@ViewBag.CourseCount</h5>
            </div>
        </div>
        <div class="stat-card bg-gradient-success">
            <i class="bi bi-person-check-fill"></i>
            <div>
                <p class="label">Sinh vi√™n ƒë√£ n·ªôp b√†i</p>
                <h5 class="value">@ViewBag.SubmittedCount</h5>
            </div>
        </div>
        <div class="stat-card bg-gradient-warning">
            <i class="bi bi-hourglass-split"></i>
            <div>
                <p class="label">Ch∆∞a n·ªôp b√†i</p>
                <h5 class="value">@ViewBag.NotSubmittedCount</h5>
            </div>
        </div>
        <div class="stat-card bg-gradient-danger">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <div>
                <p class="label">B√†i n·ªôp tr·ªÖ h·∫°n</p>
                <h5 class="value">@ViewBag.LateCount</h5>
            </div>
        </div>
    </div>

    <!-- üîπ B·∫¢NG CHI TI·∫æT TH·ªêNG K√ä -->
    <div class="table-section mt-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="fw-bold text-secondary mb-0">
                <i class="bi bi-list-ul me-2"></i>Chi ti·∫øt b√†i t·∫≠p trong kh√≥a h·ªçc
            </h5>
        </div>

        <div class="table-responsive shadow-sm rounded-3">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 40%">B√†i t·∫≠p</th>
                        <th class="text-center">ƒê√£ n·ªôp</th>
                        <th class="text-center">Ch∆∞a n·ªôp</th>
                        <th class="text-center">N·ªôp tr·ªÖ</th>
                        <th class="text-center">ƒêi·ªÉm trung b√¨nh</th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        var stats = ViewBag.AssignmentStats as IEnumerable<dynamic>;
                    }
                    @if (stats == null || !stats.Any())
                    {
                        <tr><td colspan="5" class="text-center text-muted py-4">Ch∆∞a c√≥ b√†i t·∫≠p trong kh√≥a h·ªçc n√†y.</td></tr>
                    }
                    else
                    {
                        @foreach (var a in stats)
                        {
                            <tr>
                                <td><i class="bi bi-file-earmark-text me-2 text-primary"></i>@a.Title</td>
                                <td class="text-center text-success fw-semibold">@a.Submitted</td>
                                <td class="text-center text-secondary">@a.NotSubmitted</td>
                                <td class="text-center text-danger">@a.Late</td>
                                <td class="text-center">
                                    @if (a.AvgGrade > 0)
                                    {
                                        <span class="badge bg-info text-dark">@a.AvgGrade.ToString("0.0")</span>
                                    }
                                    else
                                    {
                                        <span class="text-muted">‚Äì</span>
                                    }
                                </td>
                            </tr>
                        }
                    }

                </tbody>
            </table>
        </div>
    </div>

</div>

@section Scripts {
    <script src="~/js/Instructor/Statistic/Statistic.js" asp-append-version="true"></script>
}
