@{
    ViewData["Title"] = "Instructor Home";
    Layout = "~/Views/Instructor/Shared/_InstructorLayout.cshtml";
}
<link rel="stylesheet" href="~/css/Instructor/Home.css" asp-append-version="true" />

<div class="content-main">
    <!-- ‚úÖ Th·ªëng k√™ t·ªïng quan -->
    <div class="status">
        <!-- üîπ C√°c kh√≥a h·ªçc g·∫ßn ƒë√¢y -->
        <div class="d-flex align-items-center justify-content-between  ">
            <h5 class="section-title mb-0">
                <i class="bi bi-mortarboard-fill me-2"></i>Kh√≥a h·ªçc g·∫ßn ƒë√¢y
            </h5>
            <a asp-controller="CourseInstructor" asp-action="Course" class="btn btn-outline-primary btn-sm">Xem th√™m</a>
        </div>

        <div class="course-row">
            @if (ViewBag.RecentCourses != null && ((List<Course>)ViewBag.RecentCourses).Any())
            {
                foreach (var course in (List<Course>)ViewBag.RecentCourses)
                {
                    <div class="card-course">
                        <h6>@course.Name</h6>
                        <p><i class="bi bi-people"></i> @(course.Enrollments?.Count ?? 0) h·ªçc vi√™n</p>
                        <p><i class="bi bi-clock"></i> 
                            @course.BeginTime.ToString("dd/MM") - @course.EndTime.ToString("dd/MM")
                        </p>
                    </div>
                }
            }
            else
            {
                <p class="text-muted mt-2">Ch∆∞a c√≥ kh√≥a h·ªçc n√†o ƒë∆∞·ª£c xem g·∫ßn ƒë√¢y üëÄ</p>
            }
        </div>


        <!-- üîπ L·ªãch tu·∫ßn n√†y -->
        <div class="section-header mt-4 mb-3">
            <h5 class="section-title mb-0">
                <i class="bi bi-calendar-week me-2"></i>L·ªãch tu·∫ßn n√†y
            </h5>
            <a asp-controller="CalendarInstructor" asp-action="Calendar" class="btn btn-outline-primary btn-sm"> Xem l·ªãch ƒë·∫ßy ƒë·ªß</a>
        </div>


        <div class="week-table">
            <table>
                <thead>
                    <tr>
                        <th>Ca</th>
                        <th>Th·ª© 2</th>
                        <th>Th·ª© 3</th>
                        <th>Th·ª© 4</th>
                        <th>Th·ª© 5</th>
                        <th>Th·ª© 6</th>
                        <th>Th·ª© 7</th>
                        <th>CN</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var session in new[] { "S√°ng", "Chi·ªÅu", "T·ªëi" })
                    {
                        <tr>
                            <td class="time-col">@session</td>
                            @foreach (var day in new[] { "Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7", "CN" })
                            {
                                var lessons = ((Dictionary<string, Dictionary<string, List<Lesson>>>)ViewBag.WeekSchedule)[day][session];
                                if (lessons.Count > 0)
                                {
                                    <td>
                                        @foreach (var lesson in lessons)
                                        {
                                            <a href="#"
                                            class="lesson-item d-block text-decoration-none p-1 rounded event-item-hover"
                                            data-type="lesson"
                                            data-courseid="@lesson.CourseId">
                                                <strong>@lesson.Title</strong><br />
                                                <small class="text-muted">
                                                    @lesson.BeginTime.ToString("HH:mm") - @lesson.EndTime.ToString("HH:mm")
                                                </small><br />
                                                <span class="text-primary small">(@lesson.Course?.Name)</span>
                                            </a>
                                        }
                                    </td>
                                }
                                else
                                {
                                    <td class="text-muted text-center">‚Äî</td>
                                }
                            }
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- ‚úÖ C·ªôt ph·∫£i -->
    <div class="right-column">
        <div class="btn-quick">
            <h5 class="section-title mb-2">
                <i class="bi bi-lightning-fill me-2"></i>Thao t√°c nhanh
            </h5>
            <a asp-controller="LessonInstructor" asp-action="AddLesson" class="btn btn-primary">
                <i class="bi bi-book me-2"></i>T·∫°o b√†i h·ªçc m·ªõi
            </a>
            <a asp-controller="MaterialInstructor" asp-action="AddMaterial"class="btn btn-success">
                <i class="bi bi-file-earmark-arrow-up me-2"></i>Up t√†i li·ªáu
            </a>
            <a asp-controller="AssignmentInstructor" asp-action="AddAssignment"class="btn btn-warning text-white">
                <i class="bi bi-pencil-square me-2"></i>T·∫°o b√†i t·∫≠p m·ªõi
            </a>
        </div>

        <!-- üîπ S·ª± ki·ªán s·∫Øp di·ªÖn ra -->
        <div class="upcoming-events">
            <div class="events-header">
                <h5><i class="bi bi-calendar-event me-2"></i>S·∫Øp di·ªÖn ra h√¥m nay</h5>
                <a asp-controller="CalendarInstructor" asp-action="Calendar" class="btn btn-outline-primary btn-calendar">
                    <i class="bi bi-calendar2-event"></i> Xem l·ªãch
                </a>
            </div>
            <hr />

            @if ((ViewBag.UpcomingLessons?.Count > 0)
                || (ViewBag.UpcomingTests?.Count > 0)
                || (ViewBag.UpcomingExams?.Count > 0))
            {
                <ul class="list-unstyled mb-0">
                    @foreach (var l in ViewBag.UpcomingLessons)
                    {
                        <li class="mb-2">
                            <a href="#"
                            class="event-item text-decoration-none d-flex align-items-center event-item-hover"
                            data-type="lesson" data-courseid="@l.CourseId">
                                <i class="bi bi-journal-bookmark me-2 text-primary"></i>
                                <span><strong>@l.Title</strong> ‚Äî @l.BeginTime.ToString("HH:mm")</span>
                            </a>
                        </li>
                    }


                    @if (ViewBag.UpcomingTests?.Count > 0)
                    {
                        <li class="fw-bold mt-2 text-info">üìò B√†i ki·ªÉm tra:</li>
                        @foreach (var a in ViewBag.UpcomingTests)
                        {
                            <li class="mb-2 ms-3">
                                <a href="#" class="event-item text-decoration-none d-flex align-items-center event-item-hover"
                                data-type="assignment" data-courseid="@a.Lesson?.CourseId">
                                    <i class="bi bi-pencil-square me-2 text-info"></i>
                                    <span><strong>@a.Title</strong> ‚Äî @a.AvailableFrom?.ToString("HH:mm")</span>
                                </a>
                            </li>
                        }
                    }

                    @if (ViewBag.UpcomingExams?.Count > 0)
                    {
                        <li class="fw-bold mt-2 text-danger">üß≠ B√†i thi:</li>
                        @foreach (var a in ViewBag.UpcomingExams)
                        {
                            <li class="mb-2 ms-3">
                                <a href="#" class="event-item text-decoration-none d-flex align-items-center event-item-hover"
                                data-type="assignment" data-courseid="@a.Lesson?.CourseId">
                                    <i class="bi bi-clipboard2-check me-2 text-danger"></i>
                                    <span><strong>@a.Title</strong> ‚Äî @a.AvailableFrom?.ToString("HH:mm")</span>
                                </a>
                            </li>
                        }
                    }
                </ul>
            }
            else
            {
                <p class="text-muted mb-0">Kh√¥ng c√≥ s·ª± ki·ªán n√†o s·∫Øp di·ªÖn ra üéì</p>
            }
        </div>



        <!-- üîπ S·ª± ki·ªán s·∫Øp k·∫øt th√∫c -->
        <div class="endcoming-events mt-4">
            <div class="events-header">
                <h5><i class="bi bi-hourglass-bottom me-2"></i>S·∫Øp k·∫øt th√∫c h√¥m nay</h5>
                <a asp-controller="CalendarInstructor" asp-action="Calendar" class="btn btn-outline-primary btn-calendar">
                    <i class="bi bi-calendar2-event"></i> Xem l·ªãch
                </a>
            </div>
            <hr />

            @if ((ViewBag.EndingLessons?.Count > 0)
                || (ViewBag.EndingTests?.Count > 0)
                || (ViewBag.EndingExams?.Count > 0))
            {
                <ul class="list-unstyled mb-0">
                    @foreach (var l in ViewBag.EndingLessons)
                    {
                        <li class="mb-2">
                            <a href="#"
                            class="event-item text-decoration-none d-flex align-items-center event-item-hover"
                            data-type="lesson"
                            data-courseid="@l.CourseId">
                                <i class="bi bi-journal-check me-2 text-warning"></i>
                                <span><strong>@l.Title</strong> ‚Äî k·∫øt th√∫c l√∫c @l.EndTime.ToString("HH:mm")</span>
                            </a>
                        </li>
                    }

                   

                    @if (ViewBag.EndingTests?.Count > 0)
                    {
                        <li class="fw-bold mt-2 text-info">üìò B√†i ki·ªÉm tra:</li>
                        @foreach (var a in ViewBag.EndingTests)
                        {
                                Console.WriteLine($"{a.Title} | {a.Type} | From {a.AvailableFrom} | Until {a.AvailableUntil}");

                            <li class="mb-2 ms-3">
                                <a href="#"
                                class="event-item text-decoration-none d-flex align-items-center event-item-hover"
                                data-type="assignment" data-courseid="@a.Lesson?.CourseId">
                                    <i class="bi bi-pencil-square me-2 text-info"></i>
                                    <span><strong>@a.Title</strong> ‚Äî h·∫°n @a.AvailableUntil?.ToString("HH:mm")</span>
                                </a>
                            </li>
                        }
                    }

                    @if (ViewBag.EndingExams?.Count > 0)
                    {
                        <li class="fw-bold mt-2 text-danger">üß≠ B√†i thi:</li>
                        @foreach (var a in ViewBag.EndingExams)
                        {
                                Console.WriteLine($"{a.Title} | {a.Type} | From {a.AvailableFrom} | Until {a.AvailableUntil}");

                            <li class="mb-2 ms-3">
                                <a href="#"
                                class="event-item text-decoration-none d-flex align-items-center event-item-hover"
                                data-type="assignment" data-courseid="@a.Lesson?.CourseId">
                                    <i class="bi bi-clipboard2-check me-2 text-danger"></i>
                                    <span><strong>@a.Title</strong> ‚Äî h·∫°n @a.AvailableUntil?.ToString("HH:mm")</span>
                                </a>
                            </li>
                        }
                    }
                </ul>
            }
            else
            {
                <p class="text-muted mb-0">Kh√¥ng c√≥ s·ª± ki·ªán n√†o s·∫Øp k·∫øt th√∫c üéì</p>
            }
        </div>


    </div>
</div>
@section Scripts {
    <script src="~/js/Instructor/Home/Home.js" asp-append-version="true"></script>
}
